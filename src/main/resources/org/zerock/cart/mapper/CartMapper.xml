<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.zerock.cart.mapper.CartMapper">

	<!-- 장바구니 목록 조회 -->
    <select id="cartList" parameterType="string" resultType="org.zerock.cart.vo.CartItemVO">
        SELECT *
        FROM cart
        WHERE id = #{id}
    </select>
    
    <select id="getCartItem" parameterType="map" resultType="org.zerock.cart.vo.CartItemVO">
	    SELECT *
	    FROM cart
	    WHERE goods_no = #{goods_no} AND id = #{id}
	</select>

    <!-- 장바구니 상품 수량 업데이트 -->
    <update id="updateCartItem" parameterType="map">
	    UPDATE cart
	    SET quantity = #{quantity}, goods_total_price = #{goods_total_price}
	    WHERE goods_no = #{goods_no} AND id = #{id}
	</update>
	
	<!-- 장바구니 선택 여부 업데이트 -->
	<update id="updateSelection">
	    UPDATE cart 
	    SET selected = #{selected} 
	    WHERE goods_no = #{goodsNo} AND id = #{id}
	</update>

    <!-- 총 가격 업데이트 -->
    <update id="updateGoodsTotalPrice">
        UPDATE cart
        SET goods_total_price = #{goods_Tprice}
        WHERE goods_no = #{goods_no}
    </update>

    <!-- 상품 번호로 장바구니 아이템 조회 -->
    <select id="getCartItemByGoodsNo" parameterType="string" resultType="org.zerock.cart.vo.CartItemVO">
        SELECT *
        FROM cart
        WHERE goods_no = #{goods_no}
    </select>
    
    <!-- 결제완료시 선택된 상품 삭제처리 -->
    <delete id="deleteSelectedItems" parameterType="String">
	    DELETE FROM cart
	    WHERE id = #{id} AND selected != 0
	</delete>
    
    <insert id="insertHistory" parameterType="org.zerock.cart.vo.HistoryVO">
	    INSERT INTO payment_history (orderNumber, id, paymentDate, totalAmount, status)
	    VALUES (#{orderNumber}, #{id}, #{paymentDate}, #{totalAmount}, #{status})
	</insert>
	
	<insert id="insertPaymentDetail" parameterType="org.zerock.cart.vo.PaymentDetailVO">
	    INSERT INTO payment_detail (orderNumber, goods_no, goods_name, price, quantity, goods_total_price)
	    VALUES (#{orderNumber}, #{goods_no}, #{goods_name}, #{price}, #{quantity}, #{goods_total_price})
	</insert>
	
	<select id="selectHistoryByUserId" resultType="org.zerock.cart.vo.HistoryVO">
    	SELECT * FROM payment_history WHERE id = #{id} ORDER BY paymentDate DESC
	</select>
	
	<select id="selectPaymentDetailsByOrderNumber" resultType="org.zerock.cart.vo.PaymentDetailVO">
	    SELECT * FROM payment_detail WHERE orderNumber = #{orderNumber}
	</select>
	
	<select id="getHistoryByOrderNumber" parameterType="String" resultType="org.zerock.cart.vo.HistoryVO">
	    SELECT orderNumber, id, paymentDate, totalAmount, status
	    FROM payment_history
	    WHERE orderNumber = #{orderNumber}
	</select>
	
</mapper>
